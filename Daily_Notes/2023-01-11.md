Tweak sample pipe code to work with FIFO